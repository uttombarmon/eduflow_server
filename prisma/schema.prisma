generator client {
  provider = "prisma-client"
  output   = "../src/generated"
}

datasource db {
  provider = "postgresql"
}

// enums
enum UserRole {
  student
  tutor
  admin
}

// user model
model User {
  id              String   @id @default(uuid())
  name            String?
  email           String   @unique
  role            UserRole @default(student)
  avatar          String?
  authoredCourses Course[] @relation("CourseInstructor")
  posts           Post[]
  password        String?
  createdAt       DateTime @default(now())
  profile         Profile?

  // Tracking student enrollments and specific lesson completions
  enrollments    Enrollment[]
  lessonProgress LessonProgress[]
}

model Profile {
  id          String   @id @default(uuid())
  bio         String?  @db.Text
  headline    String?
  skills      String[]
  hobbies     String[]
  location    String?
  phoneNumber String?
  website     String?
  github      String?
  linkedin    String?
  twitter     String?

  userId String @unique
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  experiences Experience[]
  projects    Project[]
  educations  Education[]

  updatedAt DateTime @updatedAt
}

model Experience {
  id          String    @id @default(uuid())
  company     String
  position    String
  location    String?
  startDate   DateTime
  endDate     DateTime?
  description String?   @db.Text

  profileId String
  profile   Profile @relation(fields: [profileId], references: [id], onDelete: Cascade)
}

model Project {
  id           String   @id @default(uuid())
  title        String
  description  String?  @db.Text
  link         String?
  githubLink   String?
  technologies String[]

  profileId String
  profile   Profile @relation(fields: [profileId], references: [id], onDelete: Cascade)
}

model Education {
  id           String    @id @default(uuid())
  school       String
  degree       String?
  fieldOfStudy String?
  startDate    DateTime
  endDate      DateTime?

  profileId String
  profile   Profile @relation(fields: [profileId], references: [id], onDelete: Cascade)
}

// course model
model Course {
  id            String   @id @default(uuid())
  title         String
  description   String
  thumbnail     String
  category      String
  totalDuration String
  level         String
  price         Float
  rating        Float    @default(0)
  studentsCount Int      @default(0)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  instructorId String
  instructor   User   @relation("CourseInstructor", fields: [instructorId], references: [id])

  lessons     Lesson[]
  enrollments Enrollment[]
}

model Lesson {
  id       String @id @default(uuid())
  title    String
  duration String
  videoUrl String
  content  String
  order    Int    @default(0)

  courseId String
  course   Course @relation(fields: [courseId], references: [id])

  quizzes        Quiz[]
  lessonProgress LessonProgress[]
}

// Tracks if a specific user has finished a specific lesson
model LessonProgress {
  id          String   @id @default(uuid())
  userId      String
  lessonId    String
  isCompleted Boolean  @default(true)
  completedAt DateTime @default(now())

  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)
  lesson Lesson @relation(fields: [lessonId], references: [id], onDelete: Cascade)

  @@unique([userId, lessonId])
}

// Main Enrollment record for a student in a course
model Enrollment {
  id        String   @id @default(uuid())
  userId    String
  courseId  String
  progress  Float    @default(0)
  createdAt DateTime @default(now())

  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)
  course Course @relation(fields: [courseId], references: [id], onDelete: Cascade)

  @@unique([userId, courseId])
}

model Quiz {
  id        String         @id @default(uuid())
  lessonId  String
  lesson    Lesson         @relation(fields: [lessonId], references: [id])
  questions QuizQuestion[]
}

model QuizQuestion {
  id            String   @id @default(uuid())
  question      String
  options       String[]
  correctAnswer Int

  quizId String
  quiz   Quiz   @relation(fields: [quizId], references: [id])
}

model Notification {
  id      String   @id @default(uuid())
  message String
  type    String
  time    DateTime @default(now())
}

model Post {
  id    Int    @id @default(autoincrement())
  title String
  body  String

  userId String
  user   User   @relation(fields: [userId], references: [id])
}
